name: Code Quality

on:
    push:
        branches-ignore:
            - 'refs/tags/**'
    pull_request:

jobs:
    lint-type-test:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-python@v5
              with:
                  python-version: '3.11'

            - name: Install Poetry
              run: |
                  pip install poetry
                  poetry config virtualenvs.create false

            - name: Install dependencies
              run: |
                  poetry install --no-interaction --no-root

            - name: Generate _version.py with pip editable install
              run: pip install -e .

            - name: Lint repository
              run: poe lint

            - name: Type-check repository
              run: poe type-check

            - name: Run tests
              run: poe test
